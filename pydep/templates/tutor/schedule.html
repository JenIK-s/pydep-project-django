{% extends 'tutor/base.html' %}
{% load static %}

{% block title %}Расписание{% endblock %}

{% block static %}
{% endblock %}

{% block content %}
<section class="py-5">
  <div class="container px-5">
    <div class="mb-4">
      <h1 class="fw-bold mb-1"><span class="text-danger">Расписание</span> занятий</h1>
      <p class="text-muted mb-0">Планируйте уроки по дням недели и времени.</p>
    </div>

    <div class="d-flex gap-2 mb-3">
      <a href="{% url 'tutor:lesson_create' %}" class="btn btn-outline-danger btn-sm"><i class="bi bi-plus-lg"></i> Добавить занятие</a>
      <a href="{% url 'tutor:schedule' %}" class="btn btn-outline-secondary btn-sm"><i class="bi bi-arrow-repeat"></i> Обновить</a>
    </div>

    <ul class="nav nav-tabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="teacher-tab" data-bs-toggle="tab" data-bs-target="#teacher" type="button" role="tab" aria-controls="teacher" aria-selected="true">Учитель</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="student-tab" data-bs-toggle="tab" data-bs-target="#student" type="button" role="tab" aria-controls="student" aria-selected="false">Ученик</button>
      </li>
    </ul>

    <div class="tab-content pt-3">
      <div class="tab-pane fade show active" id="teacher" role="tabpanel" aria-labelledby="teacher-tab">
        <div class="table-responsive">
          <table class="table table-hover align-middle">
            <thead class="table-light">
              <tr>
                <th scope="col">Дата</th>
                <th scope="col">Время</th>
                <th scope="col">Ученик</th>
                <th scope="col">Предмет</th>
                <th scope="col">Формат</th>
                <th scope="col">Комментарий</th>
                <th scope="col">Оплата</th>
                <th scope="col" class="text-end">Действия</th>
              </tr>
            </thead>
            <tbody>
              {% for l in teacher_lessons %}
              <tr>
                <td>{{ l.date|date:"d.m.Y" }}</td>
                <td>{{ l.start_time|time:"H:i" }}–{{ l.end_time|time:"H:i" }}</td>
                <td>{% if l.student %}{{ l.student.get_full_name|default:l.student.username }}{% else %}<span class="text-muted">—</span>{% endif %}</td>
                <td>{{ l.subject }}</td>
                <td>{{ l.get_lesson_format_display }}</td>
                <td class="text-truncate" style="max-width: 240px;">{{ l.comment }}</td>
                <td>
                  {% if l.is_paid %}
                    <span class="badge text-bg-success">Оплачено</span>
                  {% else %}
                    <span class="badge text-bg-warning">Не оплачено</span>
                  {% endif %}
                </td>
                <td class="text-end">
                  <a class="btn btn-sm btn-outline-secondary" href="{% url 'tutor:lesson_update' l.pk %}"><i class="bi bi-pencil"></i></a>
                  <a class="btn btn-sm btn-outline-danger" href="{% url 'tutor:lesson_payment' l.pk %}"><i class="bi bi-cash-coin"></i></a>
                </td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="8" class="text-muted">Пока нет занятий.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>

      <div class="tab-pane fade" id="student" role="tabpanel" aria-labelledby="student-tab">
        <div class="table-responsive">
          <table class="table table-hover align-middle">
            <thead class="table-light">
              <tr>
                <th scope="col">Дата</th>
                <th scope="col">Время</th>
                <th scope="col">Преподаватель</th>
                <th scope="col">Предмет</th>
                <th scope="col">Формат</th>
                <th scope="col">Статус</th>
              </tr>
            </thead>
            <tbody>
              {% for l in student_lessons %}
              <tr>
                <td>{{ l.date|date:"d.m.Y" }}</td>
                <td>{{ l.start_time|time:"H:i" }}–{{ l.end_time|time:"H:i" }}</td>
                <td>{{ l.teacher.get_full_name|default:l.teacher.username }}</td>
                <td>{{ l.subject }}</td>
                <td>{{ l.get_lesson_format_display }}</td>
                <td>{{ l.get_status_display }}</td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="6" class="text-muted">Пока нет занятий.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <p class="text-muted small mt-2 mb-0">Подсказка: используйте кнопки сверху для управления расписанием.</p>
  </div>
  </section>
{% endblock %}